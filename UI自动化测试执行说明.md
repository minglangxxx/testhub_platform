# UI自动化测试执行说明

## 功能概述

现在UI自动化测试套件支持真实的浏览器自动化执行，可以使用Playwright或Selenium引擎在真实浏览器中运行测试用例。

## 执行流程

### 1. 准备工作

确保已安装必要的依赖：
```bash
source .venv/bin/activate
pip install playwright selenium
playwright install chromium firefox webkit
```

### 2. 创建测试用例

在"测试用例管理"页面创建测试用例，添加测试步骤：
- 点击操作
- 填写表单
- 断言验证
- 截图等

### 3. 创建测试套件

在"套件管理"页面：
1. 点击"新增套件"
2. 输入套件名称和描述
3. 从左侧列表选择测试用例，添加到右侧
4. 调整用例执行顺序
5. 保存套件

### 4. 执行测试

点击套件的"运行"按钮：
1. 选择测试引擎：Playwright（推荐）或 Selenium
2. 选择浏览器：Chrome、Firefox、Safari、Edge
3. 选择执行模式：
   - 有头模式：可以看到浏览器窗口和执行过程
   - 无头模式：后台执行，不显示浏览器窗口
4. 点击"开始执行"

### 5. 查看报告

执行完成后，在"测试报告"页面查看：
- 执行状态
- 通过/失败统计
- 执行时长
- 详细的步骤执行结果

## 支持的操作类型

### 基本操作
- **click**: 点击元素
- **fill**: 填写输入框
- **getText**: 获取文本内容
- **waitFor**: 等待元素出现
- **hover**: 鼠标悬停
- **scroll**: 滚动到元素
- **screenshot**: 截图
- **wait**: 等待指定时间

### 断言操作
- **textContains**: 文本包含
- **textEquals**: 文本相等
- **isVisible**: 元素可见
- **exists**: 元素存在
- **hasAttribute**: 属性验证

## 执行原理

1. **后台线程执行**: 测试在后台线程中执行，不阻塞API响应
2. **实时记录**: 每个用例和步骤的执行结果实时记录到数据库
3. **错误处理**: 遇到错误时捕获异常，记录错误信息，继续执行后续用例
4. **统计汇总**: 执行完成后自动计算通过率、执行时长等统计信息

## 引擎对比

### Playwright（推荐）
- ✅ 速度快，API现代化
- ✅ 支持多浏览器（Chromium、Firefox、WebKit）
- ✅ 更好的等待机制
- ✅ 内置截图、录屏功能
- ❌ 需要单独安装浏览器驱动

### Selenium
- ✅ 成熟稳定，社区庞大
- ✅ 支持更多浏览器
- ✅ 可使用系统已安装的浏览器
- ❌ API相对老旧
- ❌ 需要配置WebDriver

## 注意事项

1. **浏览器驱动**:
   - Playwright需要先运行 `playwright install` 安装浏览器
   - Selenium需要确保系统中有对应浏览器和WebDriver

2. **执行环境**:
   - 有头模式需要图形界面环境
   - 服务器部署建议使用无头模式

3. **性能考虑**:
   - 并发执行多个套件可能消耗较多资源
   - 建议根据服务器性能控制并发数

4. **元素定位**:
   - 确保元素定位器准确
   - 建议使用CSS或XPath定位器
   - 可设置备用定位器提高稳定性

## 故障排查

### 问题1: 浏览器未启动
- 检查是否安装了playwright浏览器: `playwright install`
- 检查Selenium WebDriver是否正确配置

### 问题2: 元素定位失败
- 检查元素定位器是否正确
- 增加等待时间
- 使用更稳定的定位策略

### 问题3: 执行超时
- 调整步骤的wait_time参数
- 检查网络连接
- 检查页面加载速度
